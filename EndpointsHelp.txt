
----------------------------------
1. CORS completamente abierto en desarrollo
Permite conexiones desde cualquier origen (origin: '*')
Permite todos los métodos HTTP comunes (GET, POST, PUT, DELETE, OPTIONS, PATCH)
Permite todos los headers comunes
Se activa automáticamente cuando NODE_ENV !== 'production'
2. Rate limiting más permisivo en desarrollo
En desarrollo: 1000 peticiones por ventana de tiempo
En producción: 100 peticiones (o el valor configurado)
Excluye localhost del rate limiting en desarrollo
3. Mensajes informativos
El servidor muestra claramente si está en modo desarrollo o producción
Indica si CORS está abierto o restringido
El endpoint /health también devuelve esta información
4. Fácil cambio a producción
Solo necesitas cambiar NODE_ENV=production en tu .env
Automáticamente se aplicarán las restricciones de seguridad
-----------------------------------

2. Enviar Actualizaciones
Endpoint: POST /sync/push

Descripción: El frontend envía datos nuevos o modificados para guardar en la base de datos.

Request

{
  "username": "nombre.de.usuario",
  "db": "work_reports_db",
  "collection": "monthly_data",
  "data": [
    {
      "username": "nombre.de.usuario",
      "yearMonth": "2024-07",
      "updatedAt": "2024-07-22T09:45:00.000Z",
      "monthData": { /* datos completos del mes */ }
    }
  ]
}

Response:
{
  "toUpdate": [
    {
      "username": "nombre.de.usuario",
      "yearMonth": "2024-07",
      "updatedAt": "2024-07-22T10:15:10.123Z",
      "monthData": { /* datos guardados con nueva fecha */ }
    }
  ],
  "conflicts": []
}

Nota importante: El backend sobrescribe el updatedAt con la fecha actual del servidor.



3. Comprobar Estado
Endpoint: GET /status

Descripción: Health check del servidor.


Response:
{
  "status": "ok",
  "timestamp": "2024-07-22T10:15:10.123Z",
  "uptime": 12345.67
}



4. Probar Conexión
Endpoint: HEAD /

Descripción: Prueba rápida de conexión (sin body en la respuesta).

Response
Status: 200 OK (sin body)




## Ejemplos de uso con cURL:

```bash
# 1. Probar conexión
curl -I http://localhost:3000/

# 2. Health check
curl http://localhost:3000/status

# 3. Comprobar actualizaciones
curl -X POST http://localhost:3000/sync/check \
  -H "Content-Type: application/json" \
  -d '{
    "username": "juan.perez",
    "db": "work_reports_db",
    "collection": "monthly_data",
    "timestamps": {
      "2024-05": "2024-05-30T10:00:00.000Z",
      "2024-06": "2024-06-28T15:30:00.000Z"
    }
  }'

# 4. Enviar actualizaciones
curl -X POST http://localhost:3000/sync/push \
  -H "Content-Type: application/json" \
  -d '{
    "username": "juan.perez",
    "db": "work_reports_db",
    "collection": "monthly_data",
    "data": [
      {
        "username": "juan.perez",
        "yearMonth": "2024-07",
        "updatedAt": "2024-07-22T09:45:00.000Z",
        "monthData": {
          "22": {
            "d": "2024-07-22",
            "s": "work",
            "h": 8
          }
        }
      }
    ]
  }'

# 5. Inicializar índices
curl -X POST http://localhost:3000/sync/init-indexes \
  -H "Content-Type: application/json" \
  -d '{
    "db": "work_reports_db",
    "collection": "monthly_data"
  }'


---------------
Para ejecutar el servidor:
# Instalar dependencias (si es necesario)
npm install

# Iniciar el servidor
npm start

# O en modo desarrollo con nodemon
npm run dev

-------------------------
El backend ahora está completamente reestructurado y cumple exactamente con el contrato de API que espera tu frontend. Todos los endpoints están implementados según las especificaciones, incluyendo:

✅ POST /sync/check - Comprueba actualizaciones
✅ POST /sync/push - Envía actualizaciones (con updatedAt del servidor)
✅ GET /status - Health check
✅ HEAD / - Prueba de conexión rápida
✅ CORS abierto para desarrollo
✅ Validación completa de datos
✅ Logging detallado
✅ Manejo de errores robusto